<!doctype html>
<html lang="zxx">
<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<!-- Title -->
	<title>趣書園</title>
	<!-- Google Fonts -->
	<link href="/static/css/css2-Cabinwght400500600700_swap.css" rel="stylesheet">
	<!-- Favicon -->
	<!-- Bootstrap Min CSS -->
	<link rel="stylesheet" href="/static/css/bootstrap.min.css">
	<!-- Animate Min CSS -->
	<link rel="stylesheet" href="/static/css/animate.min.css">
	<!-- FlatIcon CSS -->
	<link rel="stylesheet" href="/static/css/flaticon.css">
	<!-- Bootstrap Icon CSS -->
	<link rel="stylesheet" href="/static/css/bootstrap-icons.css">
	<!-- Font Awesome Min CSS -->
	<link rel="stylesheet" href="/static/css/fontawesome.min.css">
	<!-- Mean Menu CSS -->
	<link rel="stylesheet" href="/static/css/meanmenu.css">
	<!-- Magnific Popup Min CSS -->
	<link rel="stylesheet" href="/static/css/magnific-popup.min.css">
	<!-- Swiper Min CSS -->
	<link rel="stylesheet" href="/static/css/swiper.min.css">
	<!-- Owl Carousel Min CSS -->
	<link rel="stylesheet" href="/static/css/owl.carousel.min.css">
	<!-- Style CSS -->
	<link rel="stylesheet" href="/static/css/style.css">
	<!-- Responsive CSS -->
	<link rel="stylesheet" href="/static/css/responsive.css">
	<!-- 網頁icon -->
	<link rel="icon" href="/static/picture/定稿-黑白.png" type="image/png">

	<!-- book-block -->
	<link rel="shortcut icon" href="../favicon.ico"> 
	<!-- <link rel="stylesheet" type="text/css" href="/static/css/default.css" /> -->
	<link rel="stylesheet" type="text/css" href="/static/css/bookblock.css" />
	<!-- custom demo style -->
	<link rel="stylesheet" type="text/css" href="/static/css/demo5.css" />
	<script src="/static/js/modernizr.custom.js"></script>
	<!-- book-block -->
	<style>
		.header {
			display: flex;
			align-items: center;
			justify-content: space-between;
		}

		.widget-title {
			margin: 0;
		}

		.class-profile {
			margin-left: 10px;
		}

		.follow-btn {
			/* padding: 5px 5px; */
			margin-top: -20px;
			background-color: #007bff;
			color: #fff;
			border: none;
			border-radius: 3px;
			cursor: pointer;
		}

		.follow-btn:hover {
			background-color: #0056b3;
		}

		.widget_categories {
			border: 1px solid #ddd;
			padding: 15px;
			border-radius: 5px;
			max-width: 500px;
			margin: 20px auto;
		}

		.widget_categories ul {
			list-style: none;
			padding: 0;
		}

		.widget_categories li {
			margin: 10px 0;
		}
	</style>
</head>
<body>
    <!-- 訊息視窗 -->
    <div id="customModal" class="modal">
        <div class="modal-content">
          <span class="close-btn">&times;</span>
          <p>你確定要登出嗎？</p>
          <div class="modal-actions">
            <button id="confirmBtn">確定</button>
            <button id="cancelBtn">取消</button>
          </div>
        </div>
      </div>
	<!-- Start Preloader Section -->
	<div class="preloader">
		<div class="spinner">
			<div class="double-bounce1"></div>
			<div class="double-bounce2"></div>
		</div>
	</div>	
	<!-- End Preloader Section -->
	
	<!-- Start Navbar Section -->
	<div class="navbar-area">
	    <div class="rainbow-responsive-nav">
	        <div class="container">
	            <div class="rainbow-responsive-menu">
	                <div class="logo">
	                    <a href="/afterlogin_home">
	                        <img src="/static/picture/logo.png" class="white-logo" alt="logo">
	                        <img src="/static/picture/logo-black.png" class="black-logo" alt="logo">
	                    </a>
	                </div>
	            </div>
	        </div>
	    </div>
	    <div class="rainbow-nav">
	        <div class="container">
	            <nav class="navbar navbar-expand-md navbar-light">
	                <a class="navbar-brand" href="/afterlogin_home">
	                    <img src="/static/picture/logo.png" class="white-logo" alt="logo">
	                    <img src="/static/picture/logo-black.png" class="black-logo" alt="logo">
	                </a>
	                <div class="collapse navbar-collapse mean-menu" id="navbarSupportedContent">
	                    <ul class="navbar-nav">
	                        <li class="nav-item">
	                            <li class="nav-item">
									<a href="/afterlogin_home" class="nav-link">故事集</a>
								</li>
								<li class="nav-item">
									<a href="/myStory" class="nav-link">歷史創作</a>
								</li>
								<li class="nav-item">
									<a href="/collection" class="nav-link">故事收藏</a>
								</li>
								<li class="nav-item">
									<a href="/follow" class="nav-link">創作者追蹤</a>
								</li>
	                    </ul>
	                    <div class="other-option">
	                        <a class="default-btn" href="/creation_story">開始創作<span></span></a>
	                    </div>

                        <!-- 使用者資料設定 -->
                        <div class="profile-icon">
                            <span class="username">{{username}}</span>
                            <a href="/user_profile">
                                <i class="fa-solid fa-user fa-xl" style="color: #ffffff;"></i>
                            </a>
                        </div>
                        <!-- 使用者資料設定 -->

                        <!-- 登出 -->
                        <div class="profile-icon">
                            <a href="#" id="logout-button">
                                <i class="fa-solid fa-power-off fa-xl" style="color: #ffffff;"></i>
                            </a>
                        </div>
                        <!-- 登出 -->
						<!-- 使用者資料設定 -->
	                </div>
	            </nav>
	        </div>
	    </div>
	</div>
	<!-- End Navbar Section -->
	
	<!-- Start Page Title Section -->
	<div class="page-title-area">
		<div class="d-table">
			<div class="d-table-cell">
				<div class="container">
					<div class="page-title-content">
						<h2>{{ details.title }}</h2> 
						<ul>
							<li><a href="/afterlogin_home">回首頁</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- End Page Title Section -->
	
	<!-- Start Class Details Section -->
	<section class="class-details-section section-padding">
		<div class="container">
			<div class="row">
				<div class="col-lg-8 col-md-12">
					<div class="class-details-content">
						<div class="main clearfix">
							<ul class="bb-custom-grid" id="bb-custom-grid">
								<li>
									<h3>{{ details.title }}</h3>
									<div class="bb-bookblock">
										<div class="bb-item"><img src="{{ details.picture_cover }}" alt="Cover Image"/></div>
    
										{% for picture in details.pictures %}
											<div class="bb-item"><img src="{{ picture }}" alt="Page Image"/></div>
										{% endfor %}
									</div>
									<nav>
										<span class="bb-current"></span>
										<span></span>
										<span></span>
										<span></span>
										<span></span>
										<span></span>
									</nav>
								</li>
							</ul>
						</div>
						
						<h3>故事簡介</h3>
						<p>{{ details.detail }}</p>
						<div class="class-description-details">
							<h4>分類標籤</h4>
							<p>{{ details.kind }}</p>
						</div>
					</div>

				</div>
				<div class="col-lg-4 col-md-12">
					<aside class="class-widget">
						<section class="widget widget_categories">
							<div class="header">
								<h3 class="widget-title">{{ details.user }}</h3>
								{% if username != details.user %}
									<div class="class-profile">
										<button class="class-fee follow-btn {% if details.follow == '已追蹤' %}following-btn{% endif %}" data-author-name="{{ details.user }}">
											{% if details.follow == '已追蹤' %}
												已追蹤
											{% else %}
												追蹤
											{% endif %}
										</button>
									</div>
                            	{% endif %}
							</div>							
							<ul>
								<li><span>收藏人數:</span> {{ details.collect }}</li>
								<li><span>粉絲:</span> {{ details.tot_follow }}</li>
								<li><span>創作故事數:</span>  {{ details.tot_stories }}</li>		
							</ul>
						</section>
						<section class="widget widget_download_btn">
							<h3 class="widget-title">線上閱讀</h3>
							<div class="section-bottom">
								<a href="{{ details.link }}" class="default-btn">閱  讀<span></span></a>
								{% if username != details.user %}
									<a href="javascript:void(0);" class="default-btn" id="collect-btn" data-story-id="{{ details.story_id }}" data-collected="{{ collected }}">
										{% if details.collected == '已收藏' %}
											已收藏
										{% else %}
											收藏故事
										{% endif %}
										<span></span>
									</a>
								{% endif %}
							</div>
						</section>
					</aside>
				</div>
			</div>
		</div>
	</section>
	<!-- End Class Details Section -->
	
	<!-- Start Footer & Subscribe Section -->
	<section class="footer-subscribe-wrapper">

		<!-- Start Footer Section -->
		<div class="footer-area ptb-100">
			<div class="container">
				<div class="row">
					<div class="col-lg-4 col-md-6 col-sm-6">
						<div class="single-footer-widget">
							<a class="footer-logo" href="#">
								<img src="/static/picture/logo-black.png" class="black-logo" alt="logo">
							</a>
							<p>生成精彩的情節和對話，讓您的孩子在享受閱讀樂趣的同時，培養他們的創意思維和語言能力。<br>家長還可以與孩子共同參與創作，增進親子間的互動和交流。</p>
							<ul class="footer-social">
								<li>
									<a href="#"> <i class="fab fa-facebook-f"></i></a>
								</li>
								<li>
									<a href="#"> <i class="fab fa-twitter"></i></a>
								</li>
								<li>
									<a href="#"> <i class="fab fa-youtube"></i></a>
								</li>
								<li>
									<a href="#"> <i class="fab fa-linkedin"></i></a>
								</li>
							</ul>
						</div>
					</div>

					<div class="col-lg-2 col-md-6 col-sm-6">
					</div>

					<div class="col-lg-2 col-md-6 col-sm-6">
						<div class="single-footer-widget">
							<div class="footer-heading">
								<h3>製作團隊-113202</h3>
							</div>
							<ul class="footer-quick-links">
								<li><a href="about.html">陳　平</a></li>
								<li><a href="classes.html">張　彤</a></li>
								<li><a href="contact.html">林嘉珮</a></li>
								<li><a href="privacy-policy.html">李佳佑</a></li>
							</ul>
						</div>
					</div>

					<div class="col-lg-4 col-md-6 col-sm-6">
						<div class="single-footer-widget">
							<div class="footer-heading">
								<h3>聯絡資訊</h3>
							</div>
							<div class="footer-info-contact"> <i class="flaticon-phone-call"></i>
								<h3>電話</h3>
								<span><a href="tel:0802235678">080 707 555-321</a></span>
							</div>
							<div class="footer-info-contact"> <i class="flaticon-envelope"></i>
								<h3>Email</h3>
								<span><a href="mailto:113202y113@gmail.com">113202y113@gmail.com</a></span>
							</div>
							<div class="footer-info-contact"> <i class="flaticon-placeholder"></i>
								<h3>地址</h3>
								<span>台北商業大學-資訊管理系</span>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>		
	<!-- End Footer Section -->
	</section>
	<!-- End Footer & Subscribe Section -->
	
	<!-- Start Copy Right Section -->
	<div class="copyright-area"></div>
	<!-- End Copy Right Section -->	
	<!-- Start Go Top Section -->
	<div class="go-top">
		<i class="fas fa-chevron-up"></i>
		<i class="fas fa-chevron-up"></i>
	</div>
	<!-- End Go Top Section -->
	
	<!-- jQuery Min JS -->
	<script src="/static/js/jquery.min.js"></script>
	<!-- Popper Min JS -->
	<script src="/static/js/popper.min.js"></script>
	<!-- Bootstrap Min JS -->
	<script src="/static/js/bootstrap.bundle.min.js"></script>
	<!-- Mean Menu JS -->
	<script src="/static/js/jquery.meanmenu.js"></script>
	<!-- Appear Min JS -->
	<script src="/static/js/jquery.appear.min.js"></script>
	<!-- CounterUp Min JS -->
	<script src="/static/js/jquery.waypoints.min.js"></script>
	<script src="/static/js/jquery.counterup.min.js"></script>
	<!-- Owl Carousel Min JS -->
	<script src="/static/js/owl.carousel.min.js"></script>
	<!-- Magnific Popup Min JS -->
	<script src="/static/js/jquery.magnific-popup.min.js"></script>
	<!-- Swiper Min JS -->
	<script src="/static/js/swiper.min.js"></script>
	<!-- WOW Min JS -->
	<script src="/static/js/wow.min.js"></script>
	<!-- Main JS -->
	<script src="/static/js/main.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<script src="/static/js/jquerypp.custom.js"></script>
	<script src="/static/js/jquery.bookblock.js"></script>

	<script>
        document.addEventListener("DOMContentLoaded", function() {
            const logoutButton = document.querySelector("#logout-button");
    
            // 獲取模態框
            var modal = document.getElementById("customModal");

            // 獲取打開模態框的按鈕（假設你有一個按鈕來觸發模態框）
            var btn = document.getElementById("logout-button");

            // 獲取關閉按鈕
            var span = document.getElementsByClassName("close-btn")[0];

            // 當用戶點擊按鈕時打開模態框
            btn.onclick = function() {
            modal.style.display = "block";
            }

            // 當用戶點擊關閉按鈕時關閉模態框
            span.onclick = function() {
            modal.style.display = "none";
            }

            // 當用戶點擊模態框外部時關閉模態框
            window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
            }

            // 確定和取消按鈕的事件處理
            document.getElementById("confirmBtn").onclick = function() {
            // 在這裡處理確定登出的邏輯
            modal.style.display = "none";
            window.location.href = "/logout";
            }

            document.getElementById("cancelBtn").onclick = function() {
            modal.style.display = "none";
            }
    
            // 追蹤按鈕點擊事件
            const followButtons = document.querySelectorAll(".follow-btn");
    
            followButtons.forEach(button => {
                button.addEventListener("click", function() {
                    const authorName = button.getAttribute("data-author-name");
    
                    if (button.classList.contains("following-btn")) {
                        // 如果已經是已追蹤狀態，點擊後可以取消追蹤
                        button.classList.remove("following-btn");
                        button.textContent = "追蹤";
    
                        // 取消追蹤
                        fetch("/delete_follow", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify({ author_name: authorName })
                        }).then(response => response.json())
                        .then(data => {
                            if (!data.success) {
                                console.error("取消追蹤失敗:", data.error);
                                // 如果出錯，恢復按鈕狀態
                                button.classList.add("following-btn");
                                button.textContent = "已追蹤";
                            }
                        });
                    } else {
                        // 點擊後變成已追蹤狀態
                        button.classList.add("following-btn");
                        button.textContent = "已追蹤";
    
                        // 追蹤
                        fetch("/add_follow", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify({ author_name: authorName })
                        }).then(response => response.json())
                        .then(data => {
                            if (!data.success) {
                                console.error("追蹤失敗:", data.error);
                                // 如果出錯，恢復按鈕狀態
                                button.classList.remove("following-btn");
                                button.textContent = "追蹤";
                            }
                        });
                    }
                });
            });
        });
    </script>
	<script>
		document.getElementById('collect-btn').addEventListener('click', function() {
			var btn = this;
			var storyId = btn.getAttribute('data-story-id');
			var collected = btn.getAttribute('data-collected') === 'true';

			// 發送AJAX請求
			var xhr = new XMLHttpRequest();
			xhr.open("POST", collected ? "/uncollect_story" : "/collect_story", true);
			xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
			xhr.onreadystatechange = function() {
				if (xhr.readyState === 4 && xhr.status === 200) {
					// 更新按鈕狀態
					btn.setAttribute('data-collected', collected ? 'false' : 'true');
					btn.innerHTML = collected ? '收藏故事<span></span>' : '已收藏<span></span>';
				}
			};
			xhr.send(JSON.stringify({ story_id: storyId }));
		});
	</script>
	<script type="text/javascript">
		var Page = (function() {

			var $grid = $( '#bb-custom-grid' );

			return {
				init : function() {
					$grid.find( 'div.bb-bookblock' ).each( function( i ) {
						
						var $bookBlock = $( this ),
							$nav = $bookBlock.next().children( 'span' ),
							bb = $bookBlock.bookblock( {
								speed : 600,
								shadows : false
							} );
							
						// add navigation events
						$nav.each( function( i ) {
							$( this ).on( 'click touchstart', function( event ) {
								var $dot = $( this );
								$nav.removeClass( 'bb-current' );
								$dot.addClass( 'bb-current' );
								$bookBlock.bookblock( 'jump', i + 1 );
								return false;
							} );
						} );
						
						// add swipe events
						$bookBlock.children().on( {
							'swipeleft' : function( event ) {
								$bookBlock.bookblock( 'next' );
								return false;
							},
							'swiperight' : function( event ) {
								$bookBlock.bookblock( 'prev' );
								return false;
							}

						} );
						
					} );
				}
			};

		})();
	</script>
	<script>
			Page.init();
	</script>
</body>
</html>
