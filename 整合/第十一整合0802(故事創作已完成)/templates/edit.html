<!doctype html>
<html lang="zxx">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Title -->
    <title>童 · 話</title>
    <!-- Google Fonts -->
    <link href="/static/css/css2-Cabinwght400500600700_swap.css" rel="stylesheet">
    <!-- Favicon -->
    <!-- Bootstrap Min CSS -->
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <!-- Animate Min CSS -->
    <link rel="stylesheet" href="/static/css/animate.min.css">
    <!-- FlatIcon CSS -->
    <link rel="stylesheet" href="/static/css/flaticon.css">
    <!-- Bootstrap Icon CSS -->
    <link rel="stylesheet" href="/static/css/bootstrap-icons.css">
    <!-- Font Awesome Min CSS -->
    <link rel="stylesheet" href="/static/css/fontawesome.min.css">
    <!-- Mean Menu CSS -->
    <link rel="stylesheet" href="/static/css/meanmenu.css">
    <!-- Magnific Popup Min CSS -->
    <link rel="stylesheet" href="/static/css/magnific-popup.min.css">
    <!-- Swiper Min CSS -->
    <link rel="stylesheet" href="/static/css/swiper.min.css">
    <!-- Owl Carousel Min CSS -->
    <link rel="stylesheet" href="/static/css/owl.carousel.min.css">
    <!-- Style CSS -->
    <link rel="stylesheet" href="/static/css/style.css">
    <!-- Responsive CSS -->
    <link rel="stylesheet" href="/static/css/responsive.css">
    <!-- 網頁icon -->
    <link rel="icon" href="/static/picture/定稿-黑白.png" type="image/png">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body>

    <!-- Start Preloader Section -->
    <div class="preloader">
        <div class="spinner">
            <div class="double-bounce1"></div>
            <div class="double-bounce2"></div>
        </div>
    </div>
    <!-- End Preloader Section -->

    <!-- Start Navbar Section -->
    <div class="navbar-area">
        <div class="rainbow-responsive-nav">
            <div class="container">
                <div class="rainbow-responsive-menu">
                    <div class="logo">
                        <a href="/afterlogin_home">
                            <img src="/static/picture/logo.png" class="white-logo" alt="logo">
                            <img src="/static/picture/logo-black.png" class="black-logo" alt="logo">
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="rainbow-nav">
            <div class="container">
                <nav class="navbar navbar-expand-md navbar-light">
                    <a class="navbar-brand" href="/afterlogin_home">
                        <img src="/static/picture/logo.png" class="white-logo" alt="logo">
                        <img src="/static/picture/logo-black.png" class="black-logo" alt="logo">
                    </a>
                    <div class="collapse navbar-collapse mean-menu" id="navbarSupportedContent">
                        <ul class="navbar-nav">
                            <li class="nav-item">
                                <a href="/afterlogin_home" class="nav-link">故事集</a>
                            </li>
                            <li class="nav-item">
                                <a href="/myStory" class="nav-link">歷史創作</a>
                            </li>
                            <li class="nav-item">
                                <a href="/collection" class="nav-link">故事收藏</a>
                            </li>
                            <li class="nav-item">
                                <a href="/follow" class="nav-link">創作者追蹤</a>
                            </li>
                        </ul>
                        <div class="other-option">
                            <a class="default-btn" href="/creation_story">開始創作<span></span></a>
                        </div>

                        <!-- 使用者資料設定 -->
                        <div class="profile-icon">
                            <a href="/user_profile">
                                <i class="fa-solid fa-user fa-xl" style="color: #ffffff;"></i>
                            </a>
                        </div>
                        <!-- 使用者資料設定 -->
                    </div>
                </nav>
            </div>
        </div>
    </div>
    <!-- End Navbar Section -->

    <!-- Start Page Title Section -->
    <div class="page-title-area">
        <div class="d-table">
            <div class="d-table-cell">
                <div class="container">
                    <div class="page-title-content">
                        <h2>創作故事</h2>
                        <ul>
                            <li><a href="/afterlogin_home">回首頁</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End Page Title Section -->

    <!-- Start Contact Section -->
    <div class="contact-section section-padding">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="section-title">
                        <h6 class="sub-title">Preview Story</h6>
                        <h2>你對生成出來的故事滿意嗎?</h2>
                    </div>
                </div>
                {% if error_message %}
				<div class="alert alert-danger" role="alert">
					{{ error_message }}
				</div>
				{% endif %}
                <div class="col-lg-10 offset-lg-1">
                    <div class="contact-form">
                        <p class="form-message"></p>
                        <form action="/save-story" method="post">
                            <div class="story-header">
                                <div>
                                    <h4>故事名稱：{{ story_title }}</h4>
                                    <h4>故事類型：{{ story_kind }}</h4>
                                </div>
                                <div>
                                    <label>
                                        <span>是否公開</span>
                                        <input type="checkbox" name="isPublic" id = "openstate">
                                    </label>

                                    <script>
                                        document.getElementById('openstate').addEventListener('change', function() {
                                            var isPublic = this.checked;
                                            console.log('是否公開:', isPublic); // 用于调试
                                    
                                            // 你可以根据需要处理 isPublic 的值
                                        });
                                    </script>
                                </div>
                            </div>
                            <div class="divider"></div>
                            <div class="row">
                                <div class="col-lg-12 col-md-12">
                                    <div class="form-group">
                                        <textarea name="message1" class="form-control" id="message1" cols="30" rows="4" required="" placeholder="第一段">{{ array_story[0][1] }}</textarea>
                                        <button type="button" class="default-btn generate-btn" id="generate-btn1">生成圖片<span></span></button>
                                        <div class="image-placeholder" id="image-placeholder1">圖片</div>
                                        <!-- 隐藏字段来保存图片文件名 -->
                                        <input type="hidden" id="image-filenames1" name="image-filenames1">
                                    </div>

                                    <script>
                                        $(document).ready(function() {
                                            $('#generate-btn1').click(function() {
                                                var message = $('#message1').val();
                                                console.log('Message:', message); // Debug: 查看 message 值
                                                
                                                $.ajax({
                                                    type: 'POST',
                                                    url: '/ai-image',
                                                    data: JSON.stringify({ message: message }),
                                                    contentType: 'application/json',
                                                    success: function(response) {
                                                        console.log('Response:', response); // Debug: 查看返回的響應數據
                                                        if (response.image_paths && response.image_paths.length > 0) {
                                                            var imagesHtml = '';
                                                            var filenames = [];
                                                            response.image_paths.forEach(function(imageUrl) {
                                                                var filename = imageUrl.split('/').pop(); // 获取文件名
                                                                filenames.push(filename);
                                                                imagesHtml += '<img src="' + imageUrl + '" alt="生成的圖片" style="max-width: 100%; height: auto; margin: 10px 0;">';
                                                            });
                                                            $('#image-placeholder1').html(imagesHtml);
                                                            $('#image-filenames1').val(filenames.join(',')); // 保存文件名到隐藏字段
                                                        } else {
                                                            $('#image-placeholder1').html('圖片生成失敗');
                                                            $('#image-filenames1').val(''); // 清空隐藏字段
                                                        }
                                                    },
                                                    error: function(error) {
                                                        console.log('Error:', error); // Debug: 查看錯誤信息
                                                        $('#image-placeholder1').html('圖片生成失敗');
                                                        $('#image-filenames1').val(''); // 清空隐藏字段
                                                    }
                                                });
                                            });
                                        });
                                    </script>
                                </div>

                                <div class="col-lg-12 col-md-12">
                                    <div class="form-group">
                                        <textarea name="message2" class="form-control" id="message2" cols="30" rows="4" required="" placeholder="第二段">{{ array_story[1][1] }}</textarea>
                                        <button type="button" class="default-btn generate-btn" id="generate-btn2">生成圖片<span></span></button>
                                        <div class="image-placeholder" id="image-placeholder2">圖片</div>
                                        <!-- 隐藏字段来保存图片文件名 -->
                                        <input type="hidden" id="image-filenames2" name="image-filenames2">
                                    </div>

                                    <script>
                                        $(document).ready(function() {
                                            $('#generate-btn2').click(function() {
                                                var message = $('#message2').val();
                                                console.log('Message:', message); // Debug: 查看 message 值
                                                
                                                $.ajax({
                                                    type: 'POST',
                                                    url: '/ai-image',
                                                    data: JSON.stringify({ message: message }),
                                                    contentType: 'application/json',
                                                    success: function(response) {
                                                        console.log('Response:', response); // Debug: 查看返回的響應數據
                                                        if (response.image_paths && response.image_paths.length > 0) {
                                                            var imagesHtml = '';
                                                            var filenames = [];
                                                            response.image_paths.forEach(function(imageUrl) {
                                                                var filename = imageUrl.split('/').pop(); // 获取文件名
                                                                filenames.push(filename);
                                                                imagesHtml += '<img src="' + imageUrl + '" alt="生成的圖片" style="max-width: 100%; height: auto; margin: 10px 0;">';
                                                            });
                                                            $('#image-placeholder2').html(imagesHtml);
                                                            $('#image-filenames2').val(filenames.join(',')); // 保存文件名到隐藏字段
                                                        } else {
                                                            $('#image-placeholder2').html('圖片生成失敗');
                                                            $('#image-filenames2').val(''); // 清空隐藏字段
                                                        }
                                                    },
                                                    error: function(error) {
                                                        console.log('Error:', error); // Debug: 查看錯誤信息
                                                        $('#image-placeholder2').html('圖片生成失敗');
                                                        $('#image-filenames2').val(''); // 清空隐藏字段
                                                    }
                                                });
                                            });
                                        });
                                    </script>
                                </div>

                                <div class="col-lg-12 col-md-12">
                                    <div class="form-group">
                                        <textarea name="message3" class="form-control" id="message3" cols="30" rows="4" required="" placeholder="第三段">{{ array_story[2][1] }}</textarea>
                                        <button type="button" class="default-btn generate-btn" id="generate-btn3">生成圖片<span></span></button>
                                        <div class="image-placeholder" id="image-placeholder3">圖片</div>
                                        <!-- 隐藏字段来保存图片文件名 -->
                                        <input type="hidden" id="image-filenames3" name="image-filenames3">
                                    </div>

                                    <script>
                                        $(document).ready(function() {
                                            $('#generate-btn3').click(function() {
                                                var message = $('#message3').val();
                                                console.log('Message:', message); // Debug: 查看 message 值
                                                
                                                $.ajax({
                                                    type: 'POST',
                                                    url: '/ai-image',
                                                    data: JSON.stringify({ message: message }),
                                                    contentType: 'application/json',
                                                    success: function(response) {
                                                        console.log('Response:', response); // Debug: 查看返回的響應數據
                                                        if (response.image_paths && response.image_paths.length > 0) {
                                                            var imagesHtml = '';
                                                            var filenames = [];
                                                            response.image_paths.forEach(function(imageUrl) {
                                                                var filename = imageUrl.split('/').pop(); // 获取文件名
                                                                filenames.push(filename);
                                                                imagesHtml += '<img src="' + imageUrl + '" alt="生成的圖片" style="max-width: 100%; height: auto; margin: 10px 0;">';
                                                            });
                                                            $('#image-placeholder3').html(imagesHtml);
                                                            $('#image-filenames3').val(filenames.join(',')); // 保存文件名到隐藏字段
                                                        } else {
                                                            $('#image-placeholder3').html('圖片生成失敗');
                                                            $('#image-filenames3').val(''); // 清空隐藏字段
                                                        }
                                                    },
                                                    error: function(error) {
                                                        console.log('Error:', error); // Debug: 查看錯誤信息
                                                        $('#image-placeholder3').html('圖片生成失敗');
                                                        $('#image-filenames3').val(''); // 清空隐藏字段
                                                    }
                                                });
                                            });
                                        });
                                    </script>
                                </div>

                                <div class="col-lg-12 col-md-12">
                                    <div class="form-group">
                                        <textarea name="message4" class="form-control" id="message4" cols="30" rows="4" required="" placeholder="第四段">{{ array_story[3][1] }}</textarea>
                                        <button type="button" class="default-btn generate-btn" id="generate-btn4">生成圖片<span></span></button>
                                        <div class="image-placeholder" id="image-placeholder4">圖片</div>
                                        <!-- 隐藏字段来保存图片文件名 -->
                                        <input type="hidden" id="image-filenames4" name="image-filenames4">
                                    </div>

                                    <script>
                                        $(document).ready(function() {
                                            $('#generate-btn4').click(function() {
                                                var message = $('#message4').val();
                                                console.log('Message:', message); // Debug: 查看 message 值
                                                
                                                $.ajax({
                                                    type: 'POST',
                                                    url: '/ai-image',
                                                    data: JSON.stringify({ message: message }),
                                                    contentType: 'application/json',
                                                    success: function(response) {
                                                        console.log('Response:', response); // Debug: 查看返回的響應數據
                                                        if (response.image_paths && response.image_paths.length > 0) {
                                                            var imagesHtml = '';
                                                            var filenames = [];
                                                            response.image_paths.forEach(function(imageUrl) {
                                                                var filename = imageUrl.split('/').pop(); // 获取文件名
                                                                filenames.push(filename);
                                                                imagesHtml += '<img src="' + imageUrl + '" alt="生成的圖片" style="max-width: 100%; height: auto; margin: 10px 0;">';
                                                            });
                                                            $('#image-placeholder4').html(imagesHtml);
                                                            $('#image-filenames4').val(filenames.join(',')); // 保存文件名到隐藏字段
                                                        } else {
                                                            $('#image-placeholder4').html('圖片生成失敗');
                                                            $('#image-filenames4').val(''); // 清空隐藏字段
                                                        }
                                                    },
                                                    error: function(error) {
                                                        console.log('Error:', error); // Debug: 查看錯誤信息
                                                        $('#image-placeholder4').html('圖片生成失敗');
                                                        $('#image-filenames4').val(''); // 清空隐藏字段
                                                    }
                                                });
                                            });
                                        });
                                    </script>
                                </div>

                                <div class="form-group">
                                    <textarea name="message5" class="form-control" id="message5" cols="30" rows="4" required="" placeholder="第五段">{{ array_story[4][1] }}</textarea>
                                    <button type="button" class="default-btn generate-btn" id="generate-btn5">生成圖片<span></span></button>
                                    <div class="image-placeholder" id="image-placeholder5">圖片</div>
                                    <!-- 隐藏字段来保存图片文件名 -->
                                    <input type="hidden" id="image-filenames5" name="image-filenames5">
                                </div>

                                <script>
                                    $(document).ready(function() {
                                        $('#generate-btn5').click(function() {
                                            var message = $('#message5').val();
                                            console.log('Message:', message); // Debug: 查看 message 值
                                            
                                            $.ajax({
                                                type: 'POST',
                                                url: '/ai-image',
                                                data: JSON.stringify({ message: message }),
                                                contentType: 'application/json',
                                                success: function(response) {
                                                    console.log('Response:', response); // Debug: 查看返回的響應數據
                                                    if (response.image_paths && response.image_paths.length > 0) {
                                                        var imagesHtml = '';
                                                        var filenames = [];
                                                        response.image_paths.forEach(function(imageUrl) {
                                                            var filename = imageUrl.split('/').pop(); // 获取文件名
                                                            filenames.push(filename);
                                                            imagesHtml += '<img src="' + imageUrl + '" alt="生成的圖片" style="max-width: 100%; height: auto; margin: 10px 0;">';
                                                        });
                                                        $('#image-placeholder5').html(imagesHtml);
                                                        $('#image-filenames5').val(filenames.join(',')); // 保存文件名到隐藏字段
                                                    } else {
                                                        $('#image-placeholder5').html('圖片生成失敗');
                                                        $('#image-filenames5').val(''); // 清空隐藏字段
                                                    }
                                                },
                                                error: function(error) {
                                                    console.log('Error:', error); // Debug: 查看錯誤信息
                                                    $('#image-placeholder5').html('圖片生成失敗');
                                                    $('#image-filenames5').val(''); // 清空隐藏字段
                                                }
                                            });
                                        });
                                    });
                                </script>

                                <div class="col-lg-12 col-md-12">
                                    <div class="contact-btn">
                                        <button type="submit" class="default-btn submit-btn">儲存故事<span></span></button>
                                    </div>
                                </div>
                                
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="custom-shape-1">
            <img src="/static/picture/shape-1.png" alt="png img">
        </div>
        <div class="custom-shape-2">
            <img src="/static/picture/shape.png" alt="png img">
        </div>
    </div>
    <!-- End Contact Section -->

    <!-- Start Footer & Subscribe Section -->
    <section class="footer-subscribe-wrapper">

        <!-- Start Footer Section -->
        <div class="footer-area ptb-100">
            <div class="container">
                <div class="row">
                    <div class="col-lg-4 col-md-6 col-sm-6">
                        <div class="single-footer-widget">
                            <a class="footer-logo" href="#">
                                <img src="/static/picture/logo-black.png" class="black-logo" alt="logo">
                            </a>
                            <p>生成精彩的情節和對話，讓您的孩子在享受閱讀樂趣的同時，培養他們的創意思維和語言能力。<br>家長還可以與孩子共同參與創作，增進親子間的互動和交流。</p>
                            <ul class="footer-social">
                                <li>
                                    <a href="#"> <i class="fab fa-facebook-f"></i></a>
                                </li>
                                <li>
                                    <a href="#"> <i class="fab fa-twitter"></i></a>
                                </li>
                                <li>
                                    <a href="#"> <i class="fab fa-youtube"></i></a>
                                </li>
                                <li>
                                    <a href="#"> <i class="fab fa-linkedin"></i></a>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <div class="col-lg-2 col-md-6 col-sm-6">
                    </div>

                    <div class="col-lg-2 col-md-6 col-sm-6">
                        <div class="single-footer-widget">
                            <div class="footer-heading">
                                <h3>製作團隊-113202</h3>
                            </div>
                            <ul class="footer-quick-links">
                                <li><a href="about.html">陳　平</a></li>
                                <li><a href="classes.html">張　彤</a></li>
                                <li><a href="contact.html">林嘉珮</a></li>
                                <li><a href="privacy-policy.html">李佳佑</a></li>
                            </ul>
                        </div>
                    </div>

                    <div class="col-lg-4 col-md-6 col-sm-6">
                        <div class="single-footer-widget">
                            <div class="footer-heading">
                                <h3>聯絡資訊</h3>
                            </div>
                            <div class="footer-info-contact"> <i class="flaticon-phone-call"></i>
                                <h3>電話</h3>
                                <span><a href="tel:0802235678">080 707 555-321</a></span>
                            </div>
                            <div class="footer-info-contact"> <i class="flaticon-envelope"></i>
                                <h3>Email</h3>
                                <span><a href="mailto:113202y113@gmail.com">113202y113@gmail.com</a></span>
                            </div>
                            <div class="footer-info-contact"> <i class="flaticon-placeholder"></i>
                                <h3>地址</h3>
                                <span>台北商業大學-資訊管理系</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Footer Section -->
    </section>
    <!-- End Footer & Subscribe Section -->

    <!-- Start Copy Right Section -->
    <div class="copyright-area"></div>
    <!-- End Copy Right Section -->

    <!-- Start Go Top Section -->
    <div class="go-top">
        <i class="fas fa-chevron-up"></i>
        <i class="fas fa-chevron-up"></i>
    </div>
    <!-- End Go Top Section -->

    <!-- jQuery Min JS -->
    <script src="/static/js/jquery.min.js"></script>
    <!-- Popper Min JS -->
    <script src="/static/js/popper.min.js"></script>
    <!-- Bootstrap Min JS -->
    <script src="/static/js/bootstrap.bundle.min.js"></script>
    <!-- Mean Menu JS -->
    <script src="/static/js/jquery.meanmenu.js"></script>
    <!-- Appear Min JS -->
    <script src="/static/js/jquery.appear.min.js"></script>
    <!-- CounterUp Min JS -->
    <script src="/static/js/jquery.waypoints.min.js"></script>
    <script src="/static/js/jquery.counterup.min.js"></script>
    <!-- Owl Carousel Min JS -->
    <script src="/static/js/owl.carousel.min.js"></script>
    <!-- Magnific Popup Min JS -->
    <script src="/static/js/jquery.magnific-popup.min.js"></script>
    <!-- Swiper Min JS -->
    <script src="/static/js/swiper.min.js"></script>
    <!-- WOW Min JS -->
    <script src="/static/js/wow.min.js"></script>
    <!-- Main JS -->
    <script src="/static/js/main.js"></script>

</body>

</html>
